<!doctype html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <title>Introducción a Dancer, micro perl web framework</title>

    <link rel="stylesheet" href="css/reveal.css">
    <link rel="stylesheet" href="css/theme/black.css">

    <!-- Theme used for syntax highlighting of code -->
    <link rel="stylesheet" href="lib/css/zenburn.css">

    <!-- Printing and PDF exports -->
    <script>
        var link = document.createElement('link');
        link.rel = 'stylesheet';
        link.type = 'text/css';
        link.href = window.location.search.match(/print-pdf/gi) ? 'css/print/pdf.css' : 'css/print/paper.css';
        document.getElementsByTagName('head')[0].appendChild(link);
    </script>

    <style media="screen" type="text/css">
        .reveal section img {
            vertical-align: middle;
            background: none;
            border: none;
            box-shadow: none;
        }
    </style>
</head>

<body>
    <div class="reveal">
        <div class="slides">
            <section>
                <h3>Camello Bailarín:</h3>
                <h4>Introducción a Dancer</h4>
                <p style="line-height: 43%">
                    <font size="4">
                        <i style="font-size: 25px;">Germán Martínez Maldonado</i>
                        <br/> (
                        <strong>GitHub</strong>: <a href="https://github.com/germaaan"> @germaaan</a> /
                        <strong>Twitter</strong>: <a href="https://twitter.com/germaaan_">@germaaan_</a>)
                        <br/><br/><i style="font-size: 25px;">Oficina de Software Libre de la Universidad de Granada</i>
                        <br/>(<strong>Twitter</strong>: <a href="https://twitter.com/OSLUGR">@OSLUGR</a> /
                        <strong>Facebook</strong>: <a href="https://www.facebook.com/SoftwareLibreUGR">@SoftwareLibreUGR</a>)
                        <br/><br/><i style="font-size: 25px;">Granada Geek</i>
                        <br/>(<a href="http://www.meetup.com/es-ES/Granada-Geek/">http://www.meetup.com/es-ES/Granada-Geek/</a>)
                    </font>
                    <br/>
                    <img alt="image" src="images/camellobailarin.png" height="250" />
                    <br/>
                    <img alt="image" src="https://i.creativecommons.org/l/by-sa/4.0/88x31.png" />
                </p>
            </section>
            <section>
                <section>
                    <h3>¿Qué es Dancer?</h3>
                    <img alt="image" src="images/dancer-logo.png" />
                    <p class="fragment">
                        Es un framework web ligero libre y abierto escrito en Perl.
                    </p>
                    <p class="fragment">
                        La versión 2 ha sido completamente reescrita para tener un diseño orientada a objetos completo más robusto y extensible.
                    </p>
                </section>
                <section>
                  <h3>¿Qué tiene Dancer?</h3>
                  <ul>
                    <li class="fragment">
                      Simplicidad y minimalismo.
                    </li>
                    <li class="fragment">
                      Soporte PSGI, plugins y diseño modular: llamadas AJAX, identificador navegador, bases de datos, REST, cookies... <a href=https://metacpan.org/pod/Dancer2::Plugins/>https://metacpan.org/pod/Dancer2::Plugins</a>
                    </li>
                    <li class="fragment">
                      Pocas dependencias.
                    </li>
                  </ul>
                </section>
                <section>
                  <h3>Métodos HTTP: GET, POST, PUT, DELETE</h3>
                  <p>
                    Comportamiento por defecto:
                    <pre>
                        <code data-trim contenteditable>
                          any '/accion' => sub {
     # code
}
              </code>
                        </pre>
                        Comportamiento concreto:
                        <pre>
                            <code data-trim contenteditable>
                              any ['get', 'post'] => '/accion' => sub {
     # code
};
                  </code>
                            </pre>
                  </p>
                </section>
                <section>
                  <h3>Declaración de rutas</h3>
                  <p>
                    Con paso de variables:
                    <pre>
                        <code data-trim contenteditable>
get '/hola/:nombre' => sub {
     return "Hola " . route_parameters->get('nombre');
};
              </code>
                        </pre>
                        Con paso de variables opcionales:
                        <pre>
                            <code data-trim contenteditable>
get '/hola/:nombre?' => sub {
     "Hola, " .
          (defined param('name') ? param('name') : "seas quien seas!");
};
                  </code>
                            </pre>
                  </p>
                </section>
                <section>
                  <h3>Matching de archivos</h3>
                  <p>
                    Nombre normal:
                    <pre>
                        <code data-trim contenteditable>
get '/download/*.*' => sub {
     my ($file, $ext) = splat;
     # código para usar el archivo $file.$ext
};
              </code>
                        </pre>
                        Expresiones regulares:
                        <pre>
                            <code data-trim contenteditable>
get qr{/hola/([\w]+)} => sub {
     my ($nombre) = splat;
     return "Hola $nombre";
};
                  </code>
                            </pre>
                  </p>
                </section>
                <section>
                  <h3>Respuestas asíncronas</h3>
                  Se hace mediante flujos (content), pero es necesario primero hacer un <strong>flush</strong>.
                  <p>
                    <pre>
                        <code data-trim contenteditable>
get '/status' => sub {
     delayed {
          response_header 'X-Foo' => 'Bar';

          flush;

          # manda contenido al usuario
          content 'Hello, world!';

          # se puede añadir más contenido al flujo
          content 'Hello, again!';

          # al terminar se cierra la conexión
          done;
     } on_error => sub {
          my ($error) = @_;
     };
};
              </code>
                        </pre>
                  </p>
                </section>
                <section>
                  <h3>Hooks</h3>
                  <pre>
                      <code data-trim contenteditable>
hook before => sub {
     var mensaje => 'Hola';
};

get '/foo/*' => sub {
     my ($match) = splat;
     vars->{mensaje};
};
</code>
          </pre>
                </section>
                <section>
                  <h3>Plantillas</h3>
                  <pre>
                      <code data-trim contenteditable>
                        set 'template'     => 'template_toolkit';
                      </code>
                                </pre>
                  <pre>
                      <code data-trim contenteditable>
hook before_template_render => sub {
    my $tokens = shift;

    $tokens->{'css_url'} = request->base . 'css/style.css';
    $tokens->{'login_url'} = uri_for('/login');
    $tokens->{'logout_url'} = uri_for('/logout');
};
                      </code>
                                </pre>
                </section>
                <section>
                  <h3>Sesiones</h3>
                  <pre>
                      <code data-trim contenteditable>
                        set 'session'      => 'Simple';
                      </code>
                                </pre>
                                <pre>
                                    <code data-trim contenteditable>
                                <div class=metanav>
[% IF not session.logged_in %]
  <a href="[% login_url %]">Acceder</a>
[% ELSE %]
  <a href="[% logout_url %]">Salir</a>
[% END %]
</div>
</code>
          </pre>
                </section>
                <section>
                  <h3>Bases de datos</h3>
                  <pre>
                      <code data-trim contenteditable>
use DBI;
                      </code>
                                </pre>
                                <pre>
                                    <code data-trim contenteditable>
                                      set 'database' => File::Spec->catfile(File::Spec->tmpdir(), 'dancr.db');
                                    </code>
                                              </pre>
                                              <pre>
                                                  <code data-trim contenteditable>
sub connect_db {
     my $dbh = DBI->connect("dbi:SQLite:dbname=".setting('database')) or
         die $DBI::errstr;

     return $dbh;
}

sub init_db {
     my $db = connect_db();
     my $schema = read_text('./schema.sql');
     $db->do($schema) or die $db->errstr;
}
                                                  </code>
                                                            </pre>
                </section>
            </section>
            <section>
                <section>
                    <h3>Instalación</h3>
                    <p>
                        <pre>
<code data-trim contenteditable>
  perl -MCPAN -e 'install Dancer2'
</code>
</pre>
                    </p>
                    <p>
                        Si no tenemos CPAN.pm configurado:
                        <pre>
                            <code data-trim contenteditable>
                    wget -O - http://cpanmin.us | sudo perl - Dancer2
                  </code>
                            </pre>
                    </p>
                </section>
                <section>
                    <h3>Creando un sitio</h3>
                    <pre>
  <code data-trim contenteditable>
    dancer2 -a MyApp
  </code>
  </pre>
                    <img alt="image" src="images/creacion.png" height="450" />
                </section>
                <section>
                    <h3>Arrancando<h3>
                    <pre>
                      <code data-trim contenteditable>
                        cd MyWeb-App && plackup -r bin/app.psgi
                      </code>
                      </pre>
                      <img alt="image" src="images/arrancando.png"/>
                </section>
                <section>
                  <h3>Accediendo</h3>
                    <img alt="image" src="images/accediendo.png" />
                </section>
            </section>

            <section>
                <h2>¿Preguntas?</h2>
            </section>
        </div>
    </div>

    <script src="lib/js/head.min.js"></script>
    <script src="js/reveal.js"></script>

    <script>
        // More info https://github.com/hakimel/reveal.js#configuration
        Reveal.initialize({
            history: true,

            // More info https://github.com/hakimel/reveal.js#dependencies
            dependencies: [{
                src: 'plugin/markdown/marked.js'
            }, {
                src: 'plugin/markdown/markdown.js'
            }, {
                src: 'plugin/notes/notes.js',
                async: true
            }, {
                src: 'plugin/highlight/highlight.js',
                async: true,
                callback: function() {
                    hljs.initHighlightingOnLoad();
                }
            }]
        });
    </script>
</body>

</html>
